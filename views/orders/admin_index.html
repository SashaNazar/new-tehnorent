<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.css">

<style>
    span a {
        color: darkgray;
    }
    td > a {
        color: darkgreen;
    }
    .sort-active {
        color: limegreen;
    }

    table {
        table-layout: fixed; /* Фиксированная ширина ячеек */
        width: 100%; /* Ширина таблицы */
    }
    .col1 { width: 65px; }
    .col2 { width: 122px; }
    .col3 { width: 128px; }
    .col4 { width: 120px; }
    .col5 { width: 115px; }
    .col6 { width: 95px; }
    .col7 { width: 160px; }
    .col8 { width: 151px; }
    .col9 { width: 102px; }

    tr.table-filters > td > input {
        position: relative;
        width: 90%;
    }
</style>

<div class="row-fluid">
    <div class="col-md-12">
        <a class="text-center" href="/admin/orders/index/1"><button class="btn btn-sm btn-primary">Новые заказы</button></a>
        <a class="text-center" href="/admin/orders/index/2"><button class="btn btn-sm btn-success">Подтвержденные заказы</button></a>
        <a class="text-center" href="/admin/orders/index/3"><button class="btn btn-sm btn-warning">Заказ у клиента</button></a>
        <a class="text-center" href="/admin/orders/index/4"><button class="btn btn-sm" style="background: #428bca; color: white;">Закрытые заказы</button></a>
        <a class="text-center" href="/admin/orders/index/5"><button class="btn btn-sm btn-danger">Просроченная аренда</button></a>
        <a class="text-center" href="/admin/orders/index/all"><button class="btn btn-sm btn-default">Все заказы</button></a>
    </div>
    <br>
    <br>

    <h3 class="text-center">Список заказов</h3>
    <br>
    <div class="text-center">
        {PAGINATION}
    </div>
    <table class="table table-bordered">
        <thead>
            <tr>
                <td style="width: 50px">
                    <b>ID</b>
                    <span style="float:right;">
                        <a href="/admin/orders/index/{STATUS}/id&DESC/{PAGE}"><i class="glyphicon glyphicon glyphicon-arrow-down"></i></a>
                        <a href="/admin/orders/index/{STATUS}/id&ASC/{PAGE}"><i class="glyphicon glyphicon-arrow-up"></i></a>
                    </span>
                </td>
                <td>
                    <b>User name</b>
                    <span style="float:right;">
                        <a href="/admin/orders/index/{STATUS}/user_name&DESC/{PAGE}"><i class="glyphicon glyphicon glyphicon-arrow-down"></i></a>
                        <a href="/admin/orders/index/{STATUS}/user_name&ASC/{PAGE}"><i class="glyphicon glyphicon-arrow-up"></i></a>
                    </span>
                </td>
                <td>
                    <b>User phone</b>
                    <span style="float:right;">
                        <a href="/admin/orders/index/{STATUS}/user_phone&DESC/{PAGE}"><i class="glyphicon glyphicon glyphicon-arrow-down"></i></a>
                        <a href="/admin/orders/index/{STATUS}/user_phone&ASC/{PAGE}"><i class="glyphicon glyphicon-arrow-up"></i></a>
                    </span>
                </td>
                <td>
                    <b>Product Id</b>
                    <span style="float:right;">
                        <a href="/admin/orders/index/{STATUS}/product_id&DESC/{PAGE}"><i class="glyphicon glyphicon glyphicon-arrow-down"></i></a>
                        <a href="/admin/orders/index/{STATUS}/product_id&ASC/{PAGE}"><i class="glyphicon glyphicon-arrow-up"></i></a>
                    </span>
                </td>
                <td>
                    <b>Status</b>
                    <span style="float:right;">
                        <a href="/admin/orders/index/{STATUS}/status&DESC/{PAGE}"><i class="glyphicon glyphicon glyphicon-arrow-down"></i></a>
                        <a href="/admin/orders/index/{STATUS}/status&ASC/{PAGE}"><i class="glyphicon glyphicon-arrow-up"></i></a>
                    </span>
                </td>
                <td>
                    <b>Created</b>
                    <span style="float:right;">
                        <a href="/admin/orders/index/{STATUS}/created&DESC/{PAGE}"><i class="glyphicon glyphicon glyphicon-arrow-down"></i></a>
                        <a href="/admin/orders/index/{STATUS}/created&ASC/{PAGE}"><i class="glyphicon glyphicon-arrow-up"></i></a>
                    </span>
                </td>
                <td>
                    <b>Updated</b>
                    <span style="float:right;">
                        <a href="/admin/orders/index/{STATUS}/updated&DESC/{PAGE}"><i class="glyphicon glyphicon glyphicon-arrow-down"></i></a>
                        <a href="/admin/orders/index/{STATUS}/updated&ASC/{PAGE}"><i class="glyphicon glyphicon-arrow-up"></i></a>
                    </span>
                </td>
                <td>
                    <b>Начало</b>
                    <span style="float:right;">
                        <a href="/admin/orders/index/{STATUS}/start_rent&DESC/{PAGE}"><i class="glyphicon glyphicon glyphicon-arrow-down"></i></a>
                        <a href="/admin/orders/index/{STATUS}/start_rent&ASC/{PAGE}"><i class="glyphicon glyphicon-arrow-up"></i></a>
                    </span>
                </td>
                <td>
                    <b>Конец</b>
                    <span style="float:right;">
                        <a href="/admin/orders/index/{STATUS}/end_rent&DESC/{PAGE}"><i class="glyphicon glyphicon glyphicon-arrow-down"></i></a>
                        <a href="/admin/orders/index/{STATUS}/end_rent&ASC/{PAGE}"><i class="glyphicon glyphicon-arrow-up"></i></a>
                    </span>
                </td>
                <td width="110px;"><b>Actions</b></td>
            </tr>
        </thead>

        <tbody>
        <col class="col1">
        <col class="col2">
        <col class="col3">
        <col class="col4">
        <col class="col6">
        <col class="col7">
        <col class="col8">
        <col class="col8">
        <col class="col8">
        <col class="col9">
        <tr class='table-filters'>
            <td><input name="id"/></td>
            <td><input name="user_name"/></td>
            <td><input name="user_phone"/></td>
            <td><input name="product_id"/></td>
            <td><input name="status"/></td>
            <td><input name="created"/></td>
            <td><input name="updated"/></td>
            <td>
                <div class='input-group date' >
                    <input type='text' class="form-control" id='datetimepicker6' name="start_rent"/>
                </div>
            </td>
            <td>
                <div class='input-group date' >
                    <input type='text' class="form-control" id='datetimepicker7' name="end_rent"/>
                </div>
            </td>
            <td>
<!--                <button class="btn btn-sm">Сбросить</button>-->
                <a href="#" id="find"><button class="btn btn-xs btn-warning">Find</button></a>
                <a href="/admin/orders/index/all" class="btn btn-xs btn-default">Reset</a>
            </td>
        </tr>
            <!-- TPL_IF ORDER -->
            <!-- TPL_BEGIN ORDER -->
            <tr class='table-data'>
                <td>{ORDER.id}</td>
                <td>{ORDER.user_name}</td>
                <td>{ORDER.user_phone}</td>
                <td><a href="/admin/products/edit/{ORDER.product_id}" target="_blank">{ORDER.product_id}</a></td>
                <td class="status">{ORDER.status}</td>
                <td>{ORDER.created}</td>
                <td>{ORDER.updated}</td>
                <td class="start_rent">{ORDER.start_rent}</td>
                <td class="end_rent">{ORDER.end_rent}</td>
                <td align="right">
                    <a href="/admin/orders/edit/{ORDER.id}"><button class="btn btn-xs btn-primary">Edit</button></a>
                    <a href="/admin/orders/delete/{ORDER.id}" onclick="return confirmDelete();" class="btn btn-xs btn-danger">Delete</a>
                </td>
            </tr>
            <!-- TPL_END ORDER -->
            <!-- TPL_END -->
        </tbody>

    </table>
    <div class="text-center">
        {PAGINATION}
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment-with-locales.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>

<script>
    $(document).ready(function () {

        //Datepicker активация
        $(function () {
            $('#datetimepicker6, #datetimepicker7').datetimepicker(
                {format: 'YYYY-MM-DD'}
            );
            $('#datetimepicker7').datetimepicker({
                useCurrent: false //Important! See issue #1075
            });
        });

        //для подсветки сортировки
        var url = window.location.pathname;
        var search = window.location.search;
        $('table thead tr').find('a[href="' + url + search + '"]').addClass('sort-active');
        ////////////////////////////////////////////

        //Для подсвечивания заказа в зависимости от статуса
        $('.status').each(function () {
            var status = $(this).html();
            switch (status) {
                case '1':
                    $(this).parent().addClass('bg-success');
                    break;
                case '2':
                    $(this).parent().addClass('bg-primary');
                    break;
                case '5':
                    $(this).parent().addClass('bg-danger')
                    break;
                default :
                    break;
            }
        });
        ////////////////////////////////////////////

        $('#find').on('click', function(e) {
            e.preventDefault();
            var search = '?';
            var $filters = $('.table-filters td input');

            var ser = window.location.search;
            if (ser.indexOf('?page=') !== -1) {
                var reg = /\?page=\d+/;
                var match = reg.exec(ser);
                search = match[0];

            }

            $filters.each(function () {

                if (search.length === 1) {
                    search += $(this).attr('name') + '=' + $(this).val();
                } else {
                    search += '&' + $(this).attr('name') + '=' + $(this).val();
                }
            });

            url = window.location.origin + window.location.pathname + search;
            history.pushState('', '', url);
            window.location.reload();
        });


        ///////////////////////////////////////
        //////////Фильтрация данных///////////////////////
        ////////////// ////////////////////////////
        $('#datetimepicker7').on('blur', function() {
            if ($(this).val() != '') {
                var find_time = moment($(this).val()).format('YYYY MM DD');
                var all_end_rent = $('.end_rent');
                all_end_rent.each(function () {
                    var time_column = moment($(this).html()).format('YYYY MM DD');
                    if (moment(find_time).isSame(time_column) === true) {
                        $(this).parent().css('display', '');
                    } else {
                        $(this).parent().css('display', 'none');
                    }
                });
            }
        });

        $('#datetimepicker6').on('blur', function() {
            if ($(this).val() != '') {
                var find_time = moment($(this).val()).format('YYYY MM DD');
                var all_start_rent = $('.start_rent');
                all_start_rent.each(function () {
                    var time_column = moment($(this).html()).format('YYYY MM DD');
                    if (moment(find_time).isSame(time_column) === true) {
                        $(this).parent().css('display', '');
                    } else {
                        $(this).parent().css('display', 'none');
                    }
                });
            }
        });
    });
</script>